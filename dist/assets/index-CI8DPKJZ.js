import"./nav-DjbL4ZGQ.js";import{t as e}from"./database-BS-gGBMO.js";import{a as t,c as n,i as r,o as i,r as a,s as o,t as s,u as c}from"./formatDate-Dq704Nri.js";import{r as l,t as u}from"./H-BDef4IoB.js";var d=await e,f=new BroadcastChannel(`hideUrlInput`),p=document.querySelector(`#url-input`);async function m(){p.hidden=(await d.get(`config`,`hide-url-input`))?.value??!1}f.onmessage=m,m();var h=await e;c(`followToots`,{async updatedTreeOverview(){S()},async updatedTree(){S()},async deletedTree(){S()},cleared(){S()}});var g=document.querySelector(`#overview`),_=document.querySelector(`#new-entry`),v;_.append(v=u(`input`,{"@keypress":e=>e.key===`Enter`&&y(v.value)}),u(`button`,{"@click":()=>y(v.value)},`Add`));async function y(e){try{let t=r(e);if(!t)return;let[n,i]=t,a=await h.get(`treeOverview`,`${n}/${i}`);if(a){alert(`You are already following this toot by ${a.rootAuthor}.`);return}await o(n,i),v.value=``}catch(t){alert(`Problem with ${e}:\n${t}`)}}var b=e=>Math.floor((e.getTime()-e.getTimezoneOffset()*(60*1e3))/(1440*60*1e3)),x=e=>{if(!e)return u(`span`,`-`);let t=b(e)-b(new Date);return u(`span.right`,(t?`${t}d `:``)+e.toLocaleTimeString(void 0,{hour:`2-digit`,minute:`2-digit`}),{title:s(e)})};async function S(){g.replaceChildren();let e=await h.transaction(`treeOverview`).store.getAll();e.length!==0&&(e.sort((e,t)=>(e.lastCreatedAt?.getTime()??Number.MAX_VALUE)-(t.lastCreatedAt?.getTime()??Number.MAX_VALUE)),l(g,u(`div.bold`,`Root Author`),u(`div.bold`,`Toots`),u(`div.bold`,`Open`),u(`div.bold`,`Last Toot`),u(`div.bold`,`Last Fetch`),u(`button`,{"@click":n},`⟳ Reload All`),u(`button`,{"@click":i},`✗ Remove All`),e.map(e=>[u(`div.separator`),u(`span.root-author`,u(`img.root-author-icon`,{src:e.rootAuthorAvatar}),` `,u(`a`,{title:`@${e.rootAcct} on ${e.instance}`,href:`tree.html#${new URLSearchParams({instance:e.instance,id:e.id})}`},e.rootAuthor?a(e.rootAuthor,e.rootAccountEmojis):e.key)),u(`div.right`,`${1+(e.nDescendants??0)}`,t=>{e.nDescendants!==e.nExpectedDescendants&&(t.classList.add(`warn`),t.textContent=`≈`+t.textContent,t.title=`Expected ${(e.nExpectedDescendants??0)+1} toot(s).`)}),u(`div.right`,e.nOpen?.toString()??``),x(e.lastCreatedAt),x(e.lastRetrievalDate),u(`button`,{"@click":()=>o(e.instance,e.id)},`⟳ Reload`),u(`button`,{"@click":()=>t(e)},`✗ Remove`),e.teaser&&u(`div.teaser`,e.teaser)])))}S();