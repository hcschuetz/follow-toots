import"./nav-DjbL4ZGQ.js";import{t as e}from"./database-BS-gGBMO.js";import{r as t,t as n}from"./H-BDef4IoB.js";import{i as r,n as i,r as a,t as o}from"./linkConfigConfig-Dmhqv2K5.js";var s=await e,c=new BroadcastChannel(`hideUrlInput`),l=document.querySelector(`#hide-url-input`);l.onchange=async()=>{await s.put(`config`,{key:`hide-url-input`,value:l.checked}),c.postMessage(null)};async function u(){l.checked=(await s.get(`config`,`hide-url-input`))?.value??!1}c.onmessage=u,u();var d=(e,t)=>Object.fromEntries(Object.entries(e).map(([e,n])=>[e,t(n,e)])),f=document.querySelector(`#config-links`),p=d(i,()=>d(o,()=>r(!1)));{let t=await e;async function n(){let e=(await t.get(`config`,`links`))?.value;e&&Object.entries(p).forEach(([t,n])=>{Object.entries(n).forEach(([n,r])=>{r.value=e[t]?.[n]??!1})})}await n();let r=new BroadcastChannel(`linkConfig`);r.onmessage=n,a(()=>{let e=d(p,e=>d(e,e=>e.value));t.put(`config`,{key:`links`,value:e}),r.postMessage(null)})}t(f,n(`div.bold.client-name`,`Frontend`),...Object.values(i).map(e=>n(`div.bold`,e)),...Object.entries(o).flatMap(([e,t])=>[n(`span.client-name`,n(`img`,{src:t.icon}),n(`span`,t.name)),...Object.keys(i).map(t=>{let r=p[t][e],i=n(`input`,{type:`checkbox`,"@change":()=>r.value=i.checked});return a(()=>{i.checked=r.value}),i})]));var m=document.querySelector(`#access-tokens`),h=n(`button`,`✗ Remove All`,{async onclick(){confirm(`Really remove all tokens?`)&&(await y.clear(`accessTokens`),await x())}}),g=n(`input.access-instance`,{type:`text`,placeholder:`e.g. "mastodon.social"`}),_=n(`input.access-token`,{type:`text`,placeholder:`(typically 43 characters)`}),v=n(`button.access-save`,`+ Save`),y=await e,b=new BroadcastChannel(`accessTokens`);b.onmessage=S;async function x(){b.postMessage(null),await S()}async function S(){let e=await y.getAll(`accessTokens`);h.disabled=e.length===0,t(m,n(`span.bold`,`Instance`),n(`span.bold`,`Token`),h,n(`span.dummy`),...e.flatMap(({instance:e,token:t})=>[n(`span.access-instance`,e),n(`span.access-token`,t),n(`button`,`✗ Remove`,{async onclick(){confirm(`Really remove token for "${e}"?`)&&await y.delete(`accessTokens`,e),await x()}}),n(`button`,`Edit`,{onclick(){g.value=e,_.value=t,C()}})]),g,_,v,n(`span.dummy`))}await S();function C(){v.disabled=!g.value.trim()||!_.value.trim()}g.addEventListener(`input`,C),_.addEventListener(`input`,C),C();async function w(){let e=g.value.trim(),t=_.value.trim();if(!e||!t){alert(`Fill in the fields before clicking "Save"`);return}await y.get(`accessTokens`,e)&&!confirm(`Overwrite token for "${e}"?`)||(await y.put(`accessTokens`,{instance:e,token:t}),g.value=``,_.value=``,C(),g.focus(),await x())}v.onclick=w;function T(e){e.key===`Enter`&&!v.disabled&&(w(),e.stopImmediatePropagation(),e.preventDefault())}g.addEventListener(`keypress`,T),_.addEventListener(`keypress`,T);