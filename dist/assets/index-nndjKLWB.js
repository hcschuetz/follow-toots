import"./add-nav-BC_C3N2T.js";import{t as e}from"./database-BS-gGBMO.js";import{a as t,i as n,l as r,n as i,o as a,r as o,s}from"./emojify-B-YK_1Pt.js";import{t as c}from"./H-DDHwTD97.js";var l=await e,u=new BroadcastChannel(`hideUrlInput`),d=document.querySelector(`#url-input`);async function f(){d.hidden=(await l.get(`config`,`hide-url-input`))?.value??!1}u.onmessage=f,f();var p=await e;r(`followToots`,{async updatedTreeOverview(){b()},async updatedTree(){b()},async deletedTree(){b()},cleared(){b()}});var m=document.querySelector(`#overview`),h=document.querySelector(`#new-entry`),g;h.append(g=c(`input`,{"@keypress":e=>e.key===`Enter`&&_(g.value)}),c(`button`,{"@click":()=>_(g.value)},`Add`));async function _(e){try{let t=o(e);if(!t)return;let[n,r]=t,i=await p.get(`treeOverview`,`${n}/${r}`);if(i){alert(`You are already following this toot by ${i.rootAuthor}.`);return}await a(n,r),g.value=``}catch(t){alert(`Problem with ${e}:\n${t}`)}}var v=e=>Math.floor((e.getTime()-e.getTimezoneOffset()*(60*1e3))/(1440*60*1e3)),y=e=>{if(!e)return c(`span`,`-`);let t=v(e)-v(new Date);return c(`span.right`,(t?`${t}d `:``)+e.toLocaleTimeString(void 0,{hour:`2-digit`,minute:`2-digit`}),{title:e.toLocaleString(`sv`)})};async function b(){let e=await p.transaction(`treeOverview`).store.getAll();if(e.length===0){m.replaceChildren();return}e.sort((e,t)=>(e.lastCreatedAt?.getTime()??Number.MAX_VALUE)-(t.lastCreatedAt?.getTime()??Number.MAX_VALUE)),m.replaceChildren(c(`div.bold`,`Root Author`),c(`div.bold`,`Toots`),c(`div.bold`,`Open`),c(`div.bold`,`Last Toot`),c(`div.bold`,`Last Fetch`),c(`button`,{"@click":s},`⟳ Reload All`),c(`button`,{"@click":t},`✗ Remove All`),...e.flatMap(e=>[c(`div.separator`),c(`span.root-author`,c(`img.root-author-icon`,{src:e.rootAuthorAvatar}),` `,c(`a`,{title:`@${e.rootAcct} on ${e.instance}`,href:`tree.html#${new URLSearchParams({instance:e.instance,id:e.id})}`},e.rootAuthor?i(e.rootAuthor,e.rootAccountEmojis):e.key)),c(`div.right`,`${1+(e.nDescendants??0)}`,t=>{e.nDescendants!==e.nExpectedDescendants&&(t.classList.add(`warn`),t.textContent=`≈`+t.textContent,t.title=`Expected ${(e.nExpectedDescendants??0)+1} toot(s).`)}),c(`div.right`,e.nOpen?.toString()??``),y(e.lastCreatedAt),y(e.lastRetrievalDate),c(`button`,{"@click":()=>a(e.instance,e.id)},`⟳ Reload`),c(`button`,{"@click":()=>n(e)},`✗ Remove`),...e.teaser?[c(`div.teaser`,e.teaser)]:[]]))}b();