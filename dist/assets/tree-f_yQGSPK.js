import"./nav-Dd23zYRy.js";import{t as e}from"./database-BGZyZyq9.js";import{a as t,d as n,f as r,i,l as a,n as o,r as s,s as c,t as l,u}from"./formatDate-Dyo-rJ98.js";import{a as d,i as ee,n as f,o as p,r as m,t as te}from"./signals-core.module-PplyFw7G.js";import{n as ne,r as re,t as ie}from"./linkConfigConfig-YtmXU9nm.js";var h=(e,t,...n)=>m(`a`,{href:t,target:`_blank`,rel:`noopener noreferrer`},t=>e.split(/[ \.]/).forEach(e=>e&&t.classList.add(e)),...n),ae={},g=(e={})=>({keep:!0,attributes:new Map(Object.entries({...ae,...e}))}),oe=new Map(Object.entries({DIV:g(),SPAN:g({translate:!1,class:!0}),P:g(),BR:g(),I:g(),B:g(),U:g(),STRONG:g(),EM:g(),UL:g(),OL:g(),LI:g(),CODE:g(),PRE:g()}));function*se(e,t){for(let n of e.attributes)switch(t.get(n.name)){case void 0:console.warn(`skipping attribute`,n);break;case!0:yield n;break;case!1:break}}function*_(e){for(let t of e)if(t instanceof Text)yield t.textContent;else if(t instanceof HTMLAnchorElement)yield h(``,t.href,_(t.childNodes));else if(t instanceof HTMLElement){let e=oe.get(t.tagName);switch(e?.keep){case void 0:console.warn(`unknown element`,t),yield*_(t.childNodes);break;case!0:yield ee(t.tagName,se(t,e.attributes),_(t.childNodes));break;case!1:break}}else console.warn(`skipping node`,t)}var ce=new DOMParser;function*le(e){try{yield*_(ce.parseFromString(e,`text/html`).body.childNodes)}catch{yield m(`div.sanitization-error`,`[Error sanitizing "${e}"`)}}var ue=`.context-menu {\r
  position: fixed;\r
  width: max-content;\r
  z-index: 1000;\r
  display: none;\r
  list-style: none;\r
  border-radius: 3px;\r
  border: 1px solid #444;\r
  padding: 2px;\r
  background-color: #ccc;\r
  &.open {\r
    display: flex;\r
    flex-direction: column;\r
    gap: 2px;\r
  }\r
}\r
`,v=new CSSStyleSheet;v.replaceSync(ue);var y=class e extends HTMLElement{static current;open;close;itemProvider;constructor(){super();let t=this.attachShadow({mode:`open`});t.adoptedStyleSheets.push(v);let n=m(`div.context-menu`,m(`slot`));n.setAttribute(`tabindex`,`0`),t.append(n),this.open=t=>{t.ctrlKey&&(e.current?.close(),e.current=this,d(this,this.itemProvider?.()),t.preventDefault(),n.classList.add(`open`),r(n.style,{left:(t.clientX+n.offsetWidth<=window.innerWidth?t.clientX:t.clientX>=n.offsetWidth?t.clientX-n.offsetWidth:Math.max(0,window.innerWidth-n.offsetWidth))+`px`,top:(t.clientY+n.offsetHeight<=window.innerHeight?t.clientY:t.clientY>=n.offsetHeight?t.clientY-n.offsetHeight:Math.max(0,window.innerHeight-n.offsetHeight))+`px`}),n.focus(),n.onkeydown=e=>{e.key===`Escape`&&this.close()},document.addEventListener(`click`,this.close))},this.close=()=>{e.current=void 0,this.replaceChildren(),n.classList.remove(`open`),document.removeEventListener(`click`,this.close),document.removeEventListener(`contextmenu`,this.close)}}connectedCallback(){this.parentElement.addEventListener(`contextmenu`,this.open)}disconnectedCallback(){this.close(),this.parentElement.removeEventListener(`contextmenu`,this.open)}};window.customElements.define(`context-menu`,y);var de=`.menu {\r
  position: relative;\r
  display: inline-block;\r
  > summary {\r
    padding-inline: 3px;\r
    border-radius: 3px;\r
    cursor: default;\r
    &::marker {\r
      content: "";\r
    }\r
    &:hover {\r
      background-color: #0003;\r
    }\r
  }\r
  &:open::details-content {\r
    position: absolute;\r
    top: 100%;\r
    z-index: 1;\r
\r
    border: 1px solid #444;\r
    border-radius: 3px;\r
    padding: 2px;\r
    width: max-content;\r
    background-color: #ccc;\r
\r
    display: flex;\r
    flex-direction: column;\r
    gap: 2px;\r
  }\r
}\r
`,fe=new CSSStyleSheet;fe.replaceSync(de);var pe=class extends HTMLElement{close;itemProvider;constructor(){super();let e=m(`details.menu`,{onkeydown:t=>{t.key===`Escape`&&(e.open=!1)},ontoggle:()=>this.itemProvider&&d(this,e.open?this.itemProvider?.():null)},m(`summary`,`☰`),m(`slot`)),t=this.attachShadow({mode:`open`});t.adoptedStyleSheets.push(fe),t.append(e),this.close=t=>{e.open&&(e.open=!1,t.preventDefault())}}connectedCallback(){document.addEventListener(`click`,this.close)}disconnectedCallback(){document.removeEventListener(`click`,this.close)}};window.customElements.define(`drop-down-menu`,pe);var me=`modulepreload`,he=function(e,t){return new URL(e,t).href},ge={};const _e=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let e=document.getElementsByTagName(`link`),i=document.querySelector(`meta[property=csp-nonce]`),a=i?.nonce||i?.getAttribute(`nonce`);function o(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:`fulfilled`,value:e}),e=>({status:`rejected`,reason:e}))))}r=o(t.map(t=>{if(t=he(t,n),t in ge)return;ge[t]=!0;let r=t.endsWith(`.css`),i=r?`[rel="stylesheet"]`:``;if(n)for(let n=e.length-1;n>=0;n--){let i=e[n];if(i.href===t&&(!r||i.rel===`stylesheet`))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;let o=document.createElement(`link`);if(o.rel=r?`stylesheet`:me,r||(o.as=`script`),o.crossOrigin=``,o.href=t,a&&o.setAttribute(`nonce`,a),document.head.appendChild(o),r)return new Promise((e,n)=>{o.addEventListener(`load`,e),o.addEventListener(`error`,()=>n(Error(`Unable to preload CSS for ${t}`)))})}))}function i(e){let t=new Event(`vite:preloadError`,{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(let e of t||[])e.status===`rejected`&&i(e.reason);return e().catch(i)})};var b=`https://cdn.jsdelivr.net/npm/katex@0.16.28/dist/`,x;function ve(){if(!x){x=new CSSStyleSheet;let e=b+`katex.min.css`;(async()=>{try{await x.replace(await(await fetch(e)).text())}catch(e){console.error(e),alert(`Exception while getting/applying KaTeX stylesheet:
`+e)}})(),document.head.appendChild(m(`link`,{rel:`stylesheet`,href:e}))}return x}async function ye(e){try{let t=(await _e(async()=>{let{default:e}=await import(b+`contrib/auto-render.min.mjs`);return{default:e}},[],import.meta.url)).default,n=S(e);t(n);let r=C(n);e.replaceChildren(...r.childNodes)}catch(e){console.error(e),alert(`LaTeX rendering failed:
`+e)}}var be=/\$\$(?:.|\n)+\$\$|\$[^$]+\$|\\\((?:.|\n)+\\\)|\\\[(?:.|\n)+\\\]/;function xe(e){let t=e=>[...e.childNodes].some(e=>e instanceof Text&&be.test(e.data)||e instanceof Element&&xe(e)),n=S(e);return n.normalize(),t(n)}const Se=()=>m(`span`,{style:`
      font-family: Times New Roman, serif;
    `},`L`,m(`span`,{style:`
      font-size: 0.85em;
      vertical-align: 0.15em;
      margin-left: -0.36em;
      margin-right: -0.15em;    
    `},`A`),`T`,m(`span`,{style:`
      vertical-align: -0.5ex;
      margin-left: -0.1667em;
      margin-right: -0.125em;    
    `},`E`),`X`);function S(e){let t=e.cloneNode();return t.append(...[...e.childNodes].map(e=>e instanceof HTMLBRElement?`
`:e instanceof Element?S(e):e instanceof Text?e.data:``)),t}function C(e){let t=e.cloneNode();return t.append(...[...e.childNodes].flatMap(e=>e instanceof Text?e.data.split(`
`).flatMap((e,t)=>t==0?[e]:[m(`br`),e]):e instanceof Element?[C(e)]:[])),t}var Ce=`.toot-content {\r
  white-space: pre-wrap;\r
}\r
\r
p {\r
  margin-block: 0.3em;\r
  &:first-child {\r
    margin-top: 0;\r
  }\r
  &:last-child {\r
    margin-bottom: 0;\r
  }\r
}\r
\r
/* TODO make these hacks configurable?: */\r
span.ellipsis::after {\r
  content: "...";\r
}\r
span.invisible {\r
  display: inline-block;\r
  width: 0;\r
  text-wrap-mode: nowrap;\r
  overflow-x: hidden;\r
}\r
\r
.custom-emoji {\r
  position: relative;\r
  bottom: -0.12lh;\r
  height: .7lh;\r
}\r
`,w=[[`reblogs_count`,`B`,`boost`,`boosts`,`onshowboosts`],[`favourites_count`,`F`,`favourite`,`favourites`,`onshowfavs`],[`quotes_count`,`Q`,`quote`,`quotes`],[`replies_count`,`R`,`reply`,`replies`]].map(([e,t,n,r,i])=>({prop:e,abbr:t,singular:n,plural:r,method:i})),T=new CSSStyleSheet;T.replace(Ce);var E=class extends HTMLElement{#e=m(`span.contents.prefix`);#t=m(`input.seen`,{type:`checkbox`,onchange:()=>this.seen=this.seen,title:`Mark toot as seen/unseen`});#n;#r=new pe;#i=new y;set headerPrefix(e){d(this.#e,e)}get seen(){return this.#t.checked}set seen(e){this.#t.checked=e,this.onseenchange?.(new CustomEvent(`seenchanged`,{detail:this.seen}))}onseenchange;onshowboosts;onshowfavs;set dropDownMenuItemProvider(e){this.#r.itemProvider=()=>[e(this.#n,this)]}set contextMenuItemProvider(e){this.#i.itemProvider=()=>[e(this.#n,this)]}constructor(e){super(),this.#n=e;let{account:t,poll:n,card:r}=e,i=m(`span.contents`),a=w.every(({prop:t})=>e[t]===0)?null:m(`span.toot-stats`,{title:w.map(({prop:t,singular:n,plural:r})=>{let i=e[t];return`${i} ${i===1?n:r}`}).join(`, `)},w.filter(({prop:t})=>e[t]!==0).flatMap(({prop:t,abbr:n,method:r},i)=>[...i===0?[]:[`/`],m(`span`,{onclick:()=>r&&this[r]?.(e)},`${e[t]}${n}`)]));d(this,{className:`toot visibility-${e.visibility}`,tabIndex:0},this.#i,m(`div.toot-head`,this.#e,this.#t,this.#r,m(`img.toot-author-avatar`,{src:t.avatar_static}),m(`span.toot-author`,s(t.display_name,t.emojis)),m(`span.toot-acct`,`@`+t.acct),m(`span.fill`,i,a,m(`span.visibility`,e.visibility),e.edited_at?[m(`span.toot-created.line-through`,l(e.created_at)),m(`span.toot-edited`,l(e.edited_at))]:m(`span.toot-created`,l(e.created_at)))),()=>{let t=m(`div.toot-content`,le(e.content),o(e.emojis)),a=m(`div.toot-content-host`),s=a.attachShadow({mode:`open`});s.adoptedStyleSheets.push(T),s.getRootNode().appendChild(t);let c=m(`div.toot-body`,a,e.media_attachments?.length?()=>{let t=m(`ul.attachments`,e.media_attachments.map(e=>m(`li.attachment`,m(`img.preview`,{src:e.preview_url,alt:e.description??``,title:e.description??``}),e.url&&h(`media-link`,e.url,`→ ${e.type}`))));return e.sensitive?m(`details.sensitive`,m(`summary`),t):t}:void 0,n&&m(`div.poll`,m(`ul.poll`,n.options.map((e,t)=>m(`li.poll-option`,m(`span.poll-option-title`,(n.own_votes??[]).includes(t)?n.multiple?`☑`:`⦿︎`:n.multiple?`☐`:`⚪︎`,` `,e.title),m(`span.poll-option-votes`,e.votes_count?.toString(),`/`,n.voters_count?.toString())))),n.voters_count===n.votes_count?null:m(`div.poll-votes-count`,`total votes: `,n.votes_count.toString()),m(`div.poll-expiry`,e=>e.classList.add(n.expired?`poll-expired`:`poll-ongoing`),n.expires_at&&l(n.expires_at))),r&&m(`div.card`,r.image?m(`img.card-image`,{src:r.image,alt:r.image_description??``,title:r.image_description??``,width:r.width??void 0,height:r.height??void 0}):void 0,function*(){r.provider_name&&(yield r.provider_url?h(`card-provider`,r.provider_url,r.provider_name):r.provider_name),yield h(`card-title`,r.url,r.title);let e=(r.authors??[]).filter(e=>e.name);switch(e.length){case 0:r.author_name&&(yield m(`span`,`by `,r.author_url?h(`card-author`,r.author_url,r.author_name):r.author_name));break;case 1:{let{name:t,url:n}=e[0];yield m(`span`,`by `,h(`card-author`,n,t));break}default:yield`by`,yield m(`ul.card-authors`,function*(){for(let{name:t,url:n}of e)yield m(`li`,h(`card-author`,n,t))});break}r.description&&m(`div.card-description`,r.description)}));if(xe(t)){let e;p(i,m(`label`,Se(),m(`input`,n=>({type:`checkbox`,onkeydown:e=>{e.key===` `&&e.stopPropagation()},onchange:r=>{if(r.stopImmediatePropagation(),r.preventDefault(),n.checked){e=t.cloneNode(!0),ye(t);let{adoptedStyleSheets:n}=a.shadowRoot,r=ve();n.includes(r)||n.push(r)}else d(t,e.childNodes)}}))))}return e.spoiler_text&&(c=m(`details`,m(`summary`,e.spoiler_text),c)),c.classList.add(`toot-full-body`),c})}};window.customElements.define(`rendered-toot`,E);function D(e,t,n){let r=e instanceof Array?e:[...e],i=r.length,a=r.findIndex(e=>e===t),o=a;do{o=(o+1)%i;let e=r[o];if(n(e))return e}while(o!==a)}function we(e,t,n){return D([...e].reverse(),t,n)}var Te=class{disposers=[];register(e){this.disposers.push(e)}disposeAll(){for(let e of this.disposers)e();this.disposers.length=0}};const O=(e,t,n)=>m(`button.menu-entry-with-key-hint`,m(`span`,e),m(`span`,t.map((e,t)=>[t===0?null:` + `,m(`span.keyboard`,e)])),{onclick:n});var Ee=new Te;function k(e){Ee.register(te(e))}var A=await e,j=new URLSearchParams(location.hash.substring(1));try{let e=j.get(`url`);if(e){let[t,n]=i(e)??De();j.delete(`url`),j.set(`instance`,t),j.set(`id`,n),window.history.replaceState({},``,`#`+j),await A.get(`treeOverview`,`${t}/${n}`)||c(t,n)}}catch(e){alert(`something went wrong when adapting the hash: ${e}`)}function De(){throw window.close(),alert(`Could not close this window automatically.  Please close it manually.`),`Window was closed neither automatically nor manually.`}var M=j.get(`instance`),N=j.get(`id`),P=`${M}/${N}`;n(`followToots`,{async updatedTreeOverview(e){e===P&&$(!1)},async updatedTree(e){e===P&&$(!0)},async deletedTree(e){e===P&&$(!0)},cleared(){$(!0)}});var F,I,L=[],R=new Map;async function Oe(){F&&a({...F,seenIds:new Set})}async function ke(){F&&I&&a({...F,seenIds:new Set(L.map(e=>u(e)))})}var z=f(void 0,{name:`linkConfig`});async function B(){z.value=(await A.get(`config`,`links`)).value}new BroadcastChannel(`linkConfig`).addEventListener(`message`,B),B();var V=new Map,H=[];function U(e,t){H.push(e);let n=V.get(e);return n.headerPrefix=t,n}function W(e){if(!e)return;let t=V.get(e);t&&(t.focus({preventScroll:!0}),t.scrollIntoView({block:`center`,behavior:`smooth`}))}function G(e){let t=H.findIndex(t=>t===e);t<0||W(H[(t+1)%H.length])}function K(e){let t=H.length,n=H.findIndex(t=>t===e);n<0||W(H[(n-1+t)%t])}function q(e){W(D(H,e,e=>!R.get(u(e))?.value))}function J(e){W(we(H,e,e=>!R.get(u(e))?.value))}var Ae=(e,t)=>{let n=R.get(u(e)),r=n.value,i=z.value;return[O(r?`☐ Mark toot as unseen`:`☑ Mark toot as seen`,[`Space`],()=>{n.value=!r,setTimeout(()=>{t.scrollIntoView({block:`center`,behavior:`smooth`}),t.focus()},100)}),O(`Previous unseen toot`,[`Ctrl`,`⬅`],()=>J(e)),O(`Previous toot`,[`⬅`],()=>K(e)),O(`Next toot`,[`➡`],()=>G(e)),O(`Next unseen toot`,[`Ctrl`,`➡`],()=>q(e)),function*(){for(let t of ne){let n=i[t];for(let r in n)if(n[r]){let n=ie[r],i=n.urlFunctions[t](M,e);yield m(`button.open-link`,{onclick:()=>window.open(i)},m(`img.link-icon`,{src:n.icon}),` Open ${re[t].toLowerCase()} on ${n.name(M)}`)}}},()=>{let t=new URL(document.location.href);return t.hash=new URLSearchParams({url:`https://${M}/@${e.account.acct}/${e.id}`}).toString(),m(`a.follow-toot`,{href:t.toString(),target:`_blank`,rel:`noopener noreferrer`},`Follow toot`)}]},je=(e,t)=>n=>{if(!(n.shiftKey||n.altKey||n.metaKey)){switch(n.key){case`ArrowRight`:n.ctrlKey?q(e):G(e);break;case`ArrowLeft`:n.ctrlKey?J(e):K(e);break;case` `:t.value=!t.value;break;default:return}n.preventDefault(),n.stopImmediatePropagation()}},Me=document.querySelector(`#toot-tree`),Ne=document.querySelector(`#ancestors`),Y=document.querySelector(`#descendants`);function Pe(e,t){let n=e.findIndex(t);return n<0?{rest:e}:{found:e[n],rest:e.toSpliced(n,1)}}function Fe(e){let t=e.toot.account.id,n=[];for(let r=e;r;){let{found:e,rest:i}=Pe(r.children,e=>e.toot.account.id===t);n.push({toot:r.toot,children:i.map(Fe)}),r=e}return n}function Ie(){let{root:e,descendants:t}=I,n=new Map([e,...t].map(e=>[e.id,{toot:e,children:[]}]));for(let r of t){let{in_reply_to_id:t,in_reply_to_account_id:i}=r;if(!t){console.error(`descendant without uplink:`,r);continue}if(!n.has(t)){let r={toot:{is_missing:!0,id:t,in_reply_to_id:e.id,account:{id:i}},children:[]};n.get(e.id).children.push(r),n.set(t,r)}n.get(t).children.push(n.get(r.id))}let r=Fe(n.get(e.id));function*i(e){let t=0;for(let{toot:n,children:r}of e)yield m(`div.node`,`is_missing`in n?Le():U(n,e.length===1?void 0:m(`span.thread-pos`,`${++t}/${e.length}`)),function*(){r.length>0&&(yield m(`ul`,function*(){for(let e of r)yield m(`li`,i(e))}))})}Y.classList.add(`tree-root`),Y.classList.add(`chrono`),d(Y,i(r))}var Le=()=>m(`div.missing-toot`,`toot(s) missing/deleted/inaccessible`);function Re(){let{root:e,descendants:t}=I;d(Y,[e,...t].map(e=>m(`div.node`,U(e))))}var X=f(!0,{name:`display-tree`});function Z(e,...t){p(document.querySelector(e),...t)}function Q(e,...t){d(document.querySelector(e),...t)}function ze(){if(!F)return;let{rootAuthor:e,rootAccountEmojis:n,rootAuthorAvatar:r,rootAcct:i,rootCreatedAt:a,lastCreatedAt:o,lastRetrievalDate:u,nToots:d,nUnseen:ee}=F;Q(`#tree-head-name`,e?s(e,n):P),Z(`#tree-head-avatar`,{src:r}),Q(`#tree-head-acct`,i?`@${i} on ${M}`:``),Q(`#tree-head-date-from`,l(a)),Q(`#tree-head-date-to`,l(o)),Q(`#tree-head-date-fetched`,l(u)),Q(`#n-toots`,d?.toFixed()??`??`),Q(`#n-unseen`,ee?.toFixed()??`??`),Z(`#all-seen`,{onclick:()=>ke()}),Z(`#all-unseen`,{onclick:()=>Oe()}),Z(`#reload`,{onclick:()=>c(M,N)}),Z(`#remove`,{onclick:()=>t(F)}),Z(`#display-tree`,{onchange:e=>X.value=e.currentTarget.checked})}function Be(){Q(`#toot-id`,N),Q(`#toot-instance`,M),Z(`#follow`,{onclick:()=>c(M,N)}),Ne.replaceChildren(),Y.replaceChildren()}function Ve(){k(()=>{d(Ne,I.ancestors.map((e,t,n)=>[m(`div.node`,U(e)),X.value&&(n.at(t+1)??I.root).in_reply_to_id!==e.id?m(`div.node`,Le()):void 0]))})}var He=Object.entries({following:`you follow`,showing_reblogs:`you get boosts`,notifying:`you get notified about toots`,followed_by:`follows you`,blocking:`you block`,blocked_by:`blocks you`,muting:`you mute`,muting_notifications:`you mute notifications`,requested:`you request to follow`,requested_by:`requests to follow you`,domain_blocking:`you block the domain`,endorsed:`you endorse/feature`});function Ue({n:e,account:t,relationship:n}){let r=m(`span`,{slot:`label`},{title:`${t.display_name} @${t.acct}`},m(`img`,{src:t.avatar_static}),e>1?e.toString():null);if(n){let e=He.flatMap(([e,t])=>n[e]===!0?[`
- `+t]:[]).join(``),t=n.note?.trim();e&&(r.title+=e),t&&(r.title+=`

`+t),(e||t)&&r.classList.add(`indicate-relationship`)}return r}var We=document.querySelector(`#account-list-dialog`),Ge=document.querySelector(`#account-list-heading`),Ke=document.querySelector(`#account-list-grid`),qe=document.querySelector(`#account-list-close`);qe.onclick=()=>We.close();async function Je(e){let t=await A.get(`accessTokens`,M);if(!t)throw`no access token for `+M;let n=await fetch(e,{headers:{Authorization:`Bearer ${t.token}`}});if(!n.ok)throw`HTTPS status: ${n.status} ${n.statusText}`;return await n.json()}var Ye=(e,t)=>async n=>{let r=await Je(`https://${M}/api/v1/statuses/${n.id}/${t}`);Ge.replaceChildren(e),Ke.replaceChildren(...r.flatMap(e=>[m(`img`,{src:e.avatar}),m(`span.reaction-author`,s(e.display_name||e.acct,e.emojis)),m(`span.reaction-acct`,`@`+e.acct)])),We.showModal()};async function Xe(){let e=new Map;for(let t of L){let n=e.get(t.account.acct);n?n.n++:e.set(t.account.acct,{n:1,account:t.account})}let t=[...e.values()];try{let e=t.map(e=>`id[]=${encodeURIComponent(e.account.id)}`).join(`&`),n=await A.get(`accessTokens`,M);if(!n)throw`no access token for `+M;let r=await fetch(`https://${M}/api/v1/accounts/relationships?${e}`,{headers:{Authorization:`Bearer ${n.token}`}});if(!r.ok)throw`HTTPS status: ${r.status} ${r.statusText}`;let i=await r.json(),a=new Map(t.map(e=>[e.account.id,e]));for(let e of i){let t=a.get(e.id);if(!t){console.warn(`Unexpected: no stats for id "${e.id}"`);continue}t.relationship=e}}catch(e){console.warn(`When retrieving relationships:`,e)}t.sort((e,t)=>t.n-e.n),Q(`#n-users`,t.length.toString()),Q(`#user-stats`,t.map(Ue)),Ee.disposeAll(),R.clear();for(let e of L){let t=u(e),n=f(F?.seenIds.has(t)??!1);k(()=>{let e=n.value??!1;if(!F)return;let{seenIds:r}=F;r.has(t)!==e&&(e?r.add(t):r.delete(t),a(F))}),R.set(t,n)}V.clear();for(let e of L){let t=R.get(u(e)),n=p(new E(e),{contextMenuItemProvider:Ae,dropDownMenuItemProvider:Ae,onseenchange:e=>t.value=e.detail,onkeydown:je(e,t),ondblclick:()=>t.value=!t.value,onshowboosts:Ye(`Boosted By`,`reblogged_by`),onshowfavs:Ye(`Favorited By`,`favourited_by`)});k(()=>{n.seen=t.value}),V.set(e,n)}H.length=0,Ve(),k(()=>{H.length=I.ancestors.length,X.value?(Me.classList.add(`tree`),Ie()):(Me.classList.remove(`tree`),Re())}),W(I?.root)}async function $(e){if(F=await A.get(`treeOverview`,P),Z(`#app`,{hidden:!F}),Z(`#not-following`,{hidden:!!F}),!F){Be();return}if(document.title=`${F.rootAuthor}: "${F.teaser}"`,document.querySelector(`link[rel='shortcut icon']`).href=F.rootAuthorAvatar??``,ze(),e){if(I=await A.get(`treeDetails`,P),!I){document.title=F.rootAuthor??`Follow Toot`;return}let{ancestors:e,root:t,descendants:n}=I;L=[...e,t,...n],await Xe()}else{if(!I)return;let{seenIds:e}=F;for(let t of L){let n=u(t),r=R.get(n);r?r.value=e.has(n):console.warn(`Misssing "seen" signal for toot ${n}`)}}}$(!0);