import{t as e}from"./database-DitI7R1q.js";/* empty css              */import{c as t,d as n,i as r,l as i,n as a,o,r as s,t as c,u as l}from"./emojify-DCYsUf_M.js";import{t as u}from"./H-DDHwTD97.js";import{i as d,r as f,t as p}from"./linkConfigConfig-Dmhqv2K5.js";function m(e,t,r,i,o,s){let{account:d,poll:f,card:m}=e,h=i=>u(`span.contents`,a=>{r(r=>{a.replaceChildren();let o=r?.[i]??{};for(let r in o)o[r]&&a.append(n(`icon-link`,p[r].urlFunctions[i](t,e),u(`img.link-icon`,{src:p[r].icon})))})}),g;return u(`div`,{className:`toot visibility-${e.visibility}`},u(`div.toot-head`,s,g=i&&u(`button.close-open`,{"@click":i}),h(`status`),u(`span.visibility`,`[${e.visibility}]`),u(`span.toot-created`,new Date(e.created_at).toLocaleString(`sv`)),u(`img.toot-author-avatar`,{src:d.avatar_static}),u(`span.toot-author`,a(d.display_name,d.emojis)),u(`span.toot-acct`,`@`+d.acct),h(`profile`)),()=>{let t=u(`div.toot-body`,u(`div.toot-content`,...l(e.content),c(e.emojis)),e.media_attachments?.length?()=>{let t=u(`ul.attachments`,...e.media_attachments.map(e=>u(`li.attachment`,u(`img.preview`,{src:e.preview_url,title:e.description??void 0}),e.url&&n(`media-link`,e.url,`→ ${e.type}`))));return e.sensitive?u(`details.sensitive`,u(`summary`),t):t}:void 0,f&&u(`div.poll`,u(`ul.poll`,...f.options.map((e,t)=>u(`li.poll-option`,u(`span.poll-option-title`,(f.own_votes??[]).includes(t)?f.multiple?`☑`:`⦿︎`:f.multiple?`☐`:`⚪︎`,` `,e.title),u(`span.poll-option-votes`,e.votes_count?.toString(),`/`,f.voters_count?.toString())))),f.voters_count===f.votes_count?null:u(`div.poll-votes-count`,`total votes: `,f.votes_count.toString()),u(`div.poll-expiry`,e=>e.classList.add(f.expired?`poll-expired`:`poll-ongoing`),f.expires_at&&new Date(f.expires_at).toLocaleString(`sv`))),m&&u(`div.card`,n(`card-title`,m.url,m.title),m.description&&u(`div.card-description`,m.description),m.image?u(`img.card-image`,{src:m.image,alt:m.image_description??void 0}):m.html?u(`div.card-html`,{innerHTML:m.html}):void 0));return e.spoiler_text&&(t=u(`details`,u(`summary`,e.spoiler_text),t)),t.classList.add(`toot-full-body`),o?o(e=>{g.textContent=e?`+`:`−`,t.hidden=e}):t.hidden=!0,t})}var h=new URLSearchParams(location.hash.substring(1));try{let t=h.get(`url`);if(t){let[n,r]=s(t)??g();h.delete(`url`),h.set(`instance`,n),h.set(`id`,r),window.history.replaceState({},``,`#`+h),await(await e).get(`treeOverview`,`${n}/${r}`)||o(n,r)}}catch(e){alert(`something went wrong when adapting the hash: ${e}`)}function g(){throw window.close(),alert(`Could not close this window automatically.  Please close it manually.`),`Window was closed neither automatically nor manually.`}var _=`${h.get(`instance`)}/${h.get(`id`)}`;i(`followToots`,{async updatedTreeOverview(e){e===_&&V(!1)},async updatedTree(e){e===_&&V(!0)},async deletedTree(e){e===_&&V(!0)},cleared(){V(!0)}});var v=await e,y=d();async function b(){y.value=(await v.get(`treeOverview`,_))?.closedIds}var x=document.querySelector(`#app`),S=document.querySelector(`#ancestors`),C=document.querySelector(`#descendants`);async function w(){let e=await v.get(`treeOverview`,_);e&&(e.closedIds.clear(),t(e))}async function T(){let e=await v.get(`treeOverview`,_);if(!e)return;let n=await v.get(`treeDetails`,_);if(!n)return;let{root:r,descendants:i}=n,{closedIds:a}=e;[r,...i].forEach(e=>a.add(e.id)),t(e)}var E=(e,n)=>async()=>{let r=await v.get(`treeOverview`,n);if(!r)return;let{closedIds:i}=r;i.has(e)?i.delete(e):i.add(e),t(r)},D=e=>t=>{f(()=>{t(y.value?.has(e)??!1)})},O=d();async function k(){O.value=(await v.get(`config`,`links`)).value}var A=e=>{f(()=>{e(O.value)})};new BroadcastChannel(`linkConfig`).addEventListener(`message`,k),k();function j(e){if(e)return u(`li.children-mismatch`,`Mismatch: Found ${Math.abs(e)} ${Math.abs(e)===1?`child`:`children`} ${e<0?`less`:`more`} than expected.`)}function M(e){let{key:t,tootTree:n}=e;function r({toot:e,children:n},i=0){let a=n.find(t=>t.toot.account.id===e.account.id),o=n.filter(e=>e!==a),s=i+1,c=i>0||a?u(`span.thread-pos`,`#${s}`):void 0,[l]=t.split(`/`,1);return[m(e,l,A,E(e.id,t),D(e.id),c),u(`ul.tree-node`,...o.map(e=>u(`li`,...r(e))),j(n.length-e.replies_count)),...a?r(a,s):[]]}C.replaceChildren(...r(n))}async function N(e,t){let{key:n,root:r,descendants:i}=e,[a]=n.split(`/`,1),o=t?i.filter(e=>!y.value?.has(e.id)):i;C.replaceChildren(u(`ul.toot-list`,...[r,...o].map(e=>u(`li`,m(e,a,A,E(e.id,n),D(e.id))))))}var P=[`hierarchical`,`chronological`,`root + open`],F=d(`hierarchical`),I=`Possible reasons for a mismatch between expected and actual number of toots:
- Without authentication Mastodon reports at most 60 descendants.
- Some toots might be non-public.
- Replies or reply counts might not yet be propagated to your instance.
- ...`;function L(e,t,n){let{rootAuthor:i,rootAccountEmojis:s}=e;x.replaceChildren(u(`div.tree-head-author`,u(`img.tree-head-avatar`,{src:e.rootAuthorAvatar}),u(`span.tree-head-name`,i?a(i,s):_),u(`span.tree-head-acct`,e.rootAcct?`@${e.rootAcct} on ${t}`:``)),u(`span.tree-head-date`,e.rootCreatedAt?.toLocaleString(`sv`),` – `,e.lastCreatedAt?.toLocaleString(`sv`),`\u2003last fetched ${e.lastRetrievalDate?.toLocaleString(`sv`)??`-`}`),u(`span.tree-head-statistics`,u(`span`,`${1+(e.nDescendants??0)} toot(s)`),e.nDescendants===e.nExpectedDescendants?``:u(`span.warn`,{title:I},`${(e.nExpectedDescendants??0)+1} expected`),u(`span`,`${e.nOpen??`??`} open`)),u(`div.tree-head-buttons`,u(`button`,{textContent:`[−] Close all`,"@click":()=>T()}),u(`button`,{textContent:`[+] Open all`,"@click":()=>w()}),u(`button`,{textContent:`⟳ Reload`,"@click":()=>o(t,n)}),u(`button`,{textContent:`✗ Remove`,"@click":()=>e&&r(e)})),u(`div.tree-head-choose-mode`,...P.map(e=>u(`label`,u(`input`,{type:`radio`,"@click":()=>{F.value=e}},t=>{f(()=>{t.checked=e===F.value})}),e))))}function R(e,t){x.replaceChildren(u(`div`,`You are currently not following toot ${t} from ${e}. `),u(`div`,u(`button`,{textContent:`Follow`,"@click":()=>o(e,t)}),` it or close this tab.`)),S.replaceChildren(),C.replaceChildren()}function z(e){let t=e.ancestors;if(t.length===0){S.replaceChildren();return}let n=t[0],[r]=_.split(`/`,1);S.replaceChildren(u(`div.root-ancestor`,m(n,r,A),u(`div.more-ancestors`,t.length===1?`↓`:`↓\u2003${t.length-1} more ancestor toot(s)`)))}async function B(e){z(e),f(()=>{switch(F.value){case`hierarchical`:M(e);break;case`chronological`:N(e,!1);break;case`root + open`:N(e,!0);break;default:C.replaceChildren(`Oops`)}})}async function V(e){await b();let[t,n]=_.split(`/`),r=await v.get(`treeOverview`,_);if(!r){R(t,n);return}if(document.title=`${r.rootAuthor}: "${r.teaser}"`,document.querySelector(`link[rel='shortcut icon']`).href=r.rootAuthorAvatar??``,L(r,t,n),e){let e=await v.get(`treeDetails`,_);if(!e){document.title=r.rootAuthor??`Follow Toot`;return}await B(e)}}V(!0);