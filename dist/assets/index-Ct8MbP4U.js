import{r as e,t}from"./H-DvoLG5ED.js";import{a as n,i as r,l as i,n as a,o,r as s,s as c}from"./emojify-YCKR0-Hy.js";var l=await e,u=new BroadcastChannel(`hideUrlInput`),d=document.querySelector(`#url-input`);async function f(){d.hidden=(await l.get(`config`,`hide-url-input`))?.value??!1}u.onmessage=f,f();var p=await e;i(`followToots`,{async updatedTreeOverview(){b()},async updatedTree(){b()},async deletedTree(){b()},cleared(){b()}});var m=document.querySelector(`#overview`),h=document.querySelector(`#new-entry`),g;h.append(g=t(`input`,{"@keypress":e=>e.key===`Enter`&&_(g.value)}),t(`button`,{"@click":()=>_(g.value)},`Add`));async function _(e){try{let t=s(e);if(!t)return;let[n,r]=t,i=await p.get(`treeOverview`,`${n}/${r}`);if(i){alert(`You are already following this toot by ${i.rootAuthor}.`);return}await o(n,r),g.value=``}catch(t){alert(`Problem with ${e}:\n${t}`)}}var v=e=>Math.floor((e.getTime()-e.getTimezoneOffset()*(60*1e3))/(1440*60*1e3)),y=e=>{if(!e)return t(`span`,`-`);let n=v(e)-v(new Date);return t(`span.right`,(n?`${n}d `:``)+e.toLocaleTimeString(void 0,{hour:`2-digit`,minute:`2-digit`}),{title:e.toLocaleString(`sv`)})};async function b(){let e=await p.transaction(`treeOverview`).store.getAll();if(e.length===0){m.replaceChildren();return}e.sort((e,t)=>(e.lastCreatedAt?.getTime()??Number.MAX_VALUE)-(t.lastCreatedAt?.getTime()??Number.MAX_VALUE)),m.replaceChildren(t(`div.bold`,`Root Author`),t(`div.bold`,`Toots`),t(`div.bold`,`Open`),t(`div.bold`,`Last Toot`),t(`div.bold`,`Last Fetch`),t(`button`,{"@click":c},`⟳ Reload All`),t(`button`,{"@click":n},`✗ Remove All`),...e.flatMap(e=>[t(`div.separator`),t(`span.root-author`,t(`img.root-author-icon`,{src:e.rootAuthorAvatar}),` `,t(`a`,{title:`@${e.rootAcct} on ${e.instance}`,href:`tree.html#${new URLSearchParams({instance:e.instance,id:e.id})}`},e.rootAuthor?a(e.rootAuthor,e.rootAccountEmojis):e.key)),t(`div.right`,`${1+(e.nDescendants??0)}`,t=>{e.nDescendants!==e.nExpectedDescendants&&(t.classList.add(`warn`),t.textContent=`≈`+t.textContent,t.title=`Expected ${(e.nExpectedDescendants??0)+1} toot(s).`)}),t(`div.right`,e.nOpen?.toString()??``),y(e.lastCreatedAt),y(e.lastRetrievalDate),t(`button`,{"@click":()=>o(e.instance,e.id)},`⟳ Reload`),t(`button`,{"@click":()=>r(e)},`✗ Remove`),...e.teaser?[t(`div.teaser`,e.teaser)]:[]]))}b();