import{t as e}from"./database-DitI7R1q.js";/* empty css              */import{t}from"./H-DDHwTD97.js";import{i as n,n as r,r as i,t as a}from"./linkConfigConfig-Dmhqv2K5.js";var o=await e,s=new BroadcastChannel(`hideUrlInput`),c=document.querySelector(`#hide-url-input`);c.onchange=async()=>{await o.put(`config`,{key:`hide-url-input`,value:c.checked}),s.postMessage(null)};async function l(){c.checked=(await o.get(`config`,`hide-url-input`))?.value??!1}s.onmessage=l,l();var u=(e,t)=>Object.fromEntries(Object.entries(e).map(([e,n])=>[e,t(n,e)])),d=document.querySelector(`#config-links`),f=u(r,()=>u(a,()=>n(!1)));{let t=await e;async function n(){let e=(await t.get(`config`,`links`))?.value;e&&Object.entries(f).forEach(([t,n])=>{Object.entries(n).forEach(([n,r])=>{r.value=e[t]?.[n]??!1})})}await n();let r=new BroadcastChannel(`linkConfig`);r.onmessage=n,i(()=>{let e=u(f,e=>u(e,e=>e.value));t.put(`config`,{key:`links`,value:e}),r.postMessage(null)})}d.replaceChildren(t(`div.bold.client-name`,`Frontend`),...Object.values(r).map(e=>t(`div.bold`,e)),...Object.entries(a).flatMap(([e,n])=>[t(`span.client-name`,t(`img`,{src:n.icon}),t(`span`,n.name)),...Object.keys(r).map(n=>{let r=f[n][e],a=t(`input`,{type:`checkbox`,"@change":()=>r.value=a.checked});return i(()=>{a.checked=r.value}),a})]));var p=document.querySelector(`#access-tokens`),m=t(`button`,`✗ Remove All`,{async onclick(){confirm(`Really remove all tokens?`)&&(await v.clear(`accessTokens`),await b())}}),h=t(`input.access-instance`,{type:`text`,placeholder:`e.g. "mastodon.social"`}),g=t(`input.access-token`,{type:`text`,placeholder:`(typically 43 characters)`}),_=t(`button.access-save`,`+ Save`),v=await e,y=new BroadcastChannel(`accessTokens`);y.onmessage=x;async function b(){y.postMessage(null),await x()}async function x(){let e=await v.getAll(`accessTokens`);m.disabled=e.length===0,p.replaceChildren(t(`span.bold`,`Instance`),t(`span.bold`,`Token`),m,t(`span.dummy`),...e.flatMap(({instance:e,token:n})=>[t(`span.access-instance`,e),t(`span.access-token`,n),t(`button`,`✗ Remove`,{async onclick(){confirm(`Really remove token for "${e}"?`)&&await v.delete(`accessTokens`,e),await b()}}),t(`button`,`Edit`,{onclick(){h.value=e,g.value=n,S()}})]),h,g,_,t(`span.dummy`))}await x();function S(){_.disabled=!h.value.trim()||!g.value.trim()}h.addEventListener(`input`,S),g.addEventListener(`input`,S),S();async function C(){let e=h.value.trim(),t=g.value.trim();if(!e||!t){alert(`Fill in the fields before clicking "Save"`);return}await v.get(`accessTokens`,e)&&!confirm(`Overwrite token for "${e}"?`)||(await v.put(`accessTokens`,{instance:e,token:t}),h.value=``,g.value=``,S(),h.focus(),await b())}_.onclick=C;function w(e){e.key===`Enter`&&!_.disabled&&(C(),e.stopImmediatePropagation(),e.preventDefault())}h.addEventListener(`keypress`,w),g.addEventListener(`keypress`,w);