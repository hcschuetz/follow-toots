import"./nav-LWwRPReH.js";import{t as e}from"./database-BGZyZyq9.js";import{a as t,c as n,d as r,i,o as a,r as o,s,t as c}from"./formatDate-BBJ6jikc.js";import{a as l,r as u,t as d}from"./signals-core.module-PplyFw7G.js";var f=await e,p=new BroadcastChannel(`hideUrlInput`),m=document.querySelector(`#url-input`);async function h(){m.hidden=(await f.get(`config`,`hide-url-input`))?.value??!1}p.onmessage=h,h();var g=await e;r(`followToots`,{async updatedTreeOverview(){C()},async updatedTree(){C()},async deletedTree(){C()},cleared(){C()}});var _=document.querySelector(`#overview`),v=document.querySelector(`#new-entry`),y;v.append(y=u(`input`,{"@keypress":e=>e.key===`Enter`&&b(y.value)}),u(`button`,{"@click":()=>b(y.value)},`Add`));async function b(e){try{let t=i(e);if(!t)return;let[n,r]=t,a=await g.get(`treeOverview`,`${n}/${r}`);if(a){alert(`You are already following this toot by ${a.rootAuthor}.`);return}await s(n,r),y.value=``}catch(t){alert(`Problem with ${e}:\n${t}`)}}var x=e=>Math.floor((e.getTime()-e.getTimezoneOffset()*(60*1e3))/(1440*60*1e3)),S=e=>{if(!e)return u(`span`,`-`);let t=x(e)-x(new Date);return u(`span.right`,(t?`${t}d `:``)+e.toLocaleTimeString(void 0,{hour:`2-digit`,minute:`2-digit`}),{title:c(e)})};async function C(){_.replaceChildren();let e=await g.transaction(`treeOverview`).store.getAll();e.length!==0&&(e.sort((e,t)=>(e.lastCreatedAt?.getTime()??Number.MAX_VALUE)-(t.lastCreatedAt?.getTime()??Number.MAX_VALUE)),l(_,u(`div.bold`,`Root Author`),u(`div.bold`,`Toots`),u(`div.bold`,`Unseen`),u(`div.bold`,`Last Toot`),u(`div.bold`,`Last Fetch`),u(`button`,{"@click":n},`⟳ Reload All`),u(`button`,{"@click":a},`✗ Remove All`),e.map(e=>u(`div.contents`,t=>{d(()=>{t.classList.toggle(`all-seen`,!e.nUnseen)})},u(`div.separator`),u(`span.root-author`,u(`img.root-author-icon`,{src:e.rootAuthorAvatar}),` `,u(`a`,{title:`@${e.rootAcct} on ${e.instance}`,href:`tree.html#${new URLSearchParams({instance:e.instance,id:e.id})}`},e.rootAuthor?o(e.rootAuthor,e.rootAccountEmojis):e.key)),u(`div.right`,`${e.nToots??0}`),u(`div.right`,e.nUnseen?.toString()??``),S(e.lastCreatedAt),S(e.lastRetrievalDate),u(`button`,{"@click":()=>s(e.instance,e.id)},`⟳ Reload`),u(`button`,{"@click":()=>t(e)},`✗ Remove`),e.teaser&&u(`div.teaser`,e.teaser)))))}C();